<script>
    var pBar_options = document.getElementById("options");
    var pBar_select = document.getElementById("select");
    var pBar_download = document.getElementById("download");
    var pBar_directory = document.getElementById("directory");
    
    pBar_options.style.backgroundColor = "#b0b0b0";
    
    pBar_select.style.backgroundColor = "#53c322";
    pBar_download.style.backgroundColor = "#53c322";
    pBar_directory.style.backgroundColor = "#53c322";
    
</script>



<h4>Trimmomatic Trimming Options</h4>

<div id = "read">
    Single-end or Paired-end Reads? <br>
    <select id = "read_form" onchange="changeIn(this)">
        <option value="Single">Single-end</option>
        <option value="Paired">Paired-end</option>
    </select>

</div> 

<%= bootstrap_form_for @trimmomatic do |f| %>

<div id = "single" style="display:block;">
    <button type ="button" class="btn btn-outline-primary" onclick="changeIn('s_file')">Single file</button>
    <button type ="button" class="btn btn-outline-primary" onclick="changeIn('s_files')">Multiple files</button>
    
    <div id = "s_file">
        <br>
        <%= f.text_field :s_file, label: "Single file to trim:" %>
    </div>
    
    <div id = "s_files" style="display:none;">
        <br>
        <%= f.text_field :s_files, label: "Enter multiple file names seperated by a comma:" %>
        <!--<br>Enter multiple file names seperated by a comma:<textarea class = "form-control" rows = "4">Input Multiple file names</textarea> -->
    </div>
    
    </br>
</div>

<div id = "paired" style="display:none;">
    
    <button type ="button" class="btn btn-outline-primary" onclick="changeIn('p_file')">One Pair</button>
    <button type ="button" class="btn btn-outline-primary" onclick="changeIn('p_files')">Multiple Pairs</button>
    
    <div id = "p_file">
        <br>
        <%= f.text_field :p_file_R, label: "Right side read of a single pair:" %>
        <%= f.text_field :p_file_L, label: "Left side read of a single pair:"%>
    </div>
    
    <div id = "p_files" style="display:none;">
        <br>
        <%= f.text_field :p_files_R, label: "Right side read of paired files, seperated by a comma:" %>
        <%= f.text_field :p_files_L, label: "Left side read of paired files, seperated by a comma: " %>
    </div>
</div>    

<hr>
<select id = "target">
    <option value="">Select Trimming Operation</option>
    <option value="leading">Minimum quality for a base</option>
    <option value="SlidingWindow">Sliding window</option>
    <option value="crop">Crop read</option>
    <option value="Hcrop">Crop read from start</option>
    <option value="minLen">Minimum length of read</option>
</select>

<button class = "btn" id = "button" type = "button" onclick="showDiv()">
    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add Operation
</button>


<div id = "formDiv">
    <div class = "option" id = "leading" style = "display:none;">
        <p>Set the minimum quality required to keep a base.
        
        <button type ="button" class = "btn-sm" id = "trash" onclick="removeOperation(this.parentElement)">
            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        </button>
        </p>
        <div class = "form-inline">
            <%= f.number_field :leadingQ, label: "Minimum Base Quality: " %>
        </div>
    </div>
    <div id="SlidingWindow" style="display:none;" class="option">
        <p>Perform a sliding window trimming, cut read when the average quality within the window
        falls below a threshold
        
        <button type ="button" class = "btn-sm" id = "trash" onclick="removeOperation(this.parentElement)">
            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        </button>
        </p>
        
        <div class = "form-inline">
            <%= f.number_field :winSize, label: "Window Size: " %>
            <%= f.number_field :winQuality, label: "Required Quality of Window: " %>
        </div>
    
    <div id="crop" style="display:none;" class="option">
        <p>Cut off the end of a read after a desired length for every read.
        <button type ="button" class = "btn-sm" id = "trash" onclick="removeOperation(this.parentElement)">
            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        </button>
        </p>
        
        <div class = "form-inline">
            <%= f.number_field :cropLen, label: "Length from start of the read: " %>
        </div>
        
    </div>
    
    <div id="Hcrop" style="display:none;" class="option">
        <p>Cut off the start of a read after a desired length for every read.
        <button type ="button" class = "btn-sm" id = "trash" onclick="removeOperation(this.parentElement)">
            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        </button>
        </p>
        
        <div class = "form-inline">
            <%= f.number_field :HcropLen, label: "Length to crop: " %>
        </div>
        
    </div>
    
    <div id="minLen" style="display:none;" class="option">
        <p>Specifies the minimum length of a read to be kept.
        <button type ="button" class = "btn-sm" id = "trash" onclick="removeOperation(this.parentElement)">
            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        </button>
        </p>
        
        <div class = "form-inline">
            <%= f.number_field :minLen, label: "Required read length: " %>
        </div>
        
    </div>
</div><!-- end of form div -->
<hr>
<center>
        <%= f.submit "Create" %>
    <% end %>
</center>


<script>

    function removeOperation(elem){
        var form_div = elem.parentElement;
        
        form_div.style.display = "none";
    }

    /*
    Function changes displays for dropdown menu
    Creates a clone of the orginal div above, changes the name of the div so that
    it can be checked for when the button is clicked -- can't add same option twice
    
    Each dropdown element/div will have two variables in the function 
    
    elem--dropdown element selected inside add operation determines what was selected
    
    */
    function showDiv(){
        
        var elem = document.getElementById('target');
        
        var leading_div = document.getElementById('leading');
        
        var SlidWin_div = document.getElementById('SlidingWindow');
        
        var crop_div = document.getElementById('crop');
        
        var Hcrop_div = document.getElementById('Hcrop');
        
        var minLen_div = document.getElementById('minLen');
        
        
        if(elem.value == "leading"){
            leading_div.style.display = leading_div.style.display == "none" ? "block" : "none";
        }
        else if(elem.value == "SlidingWindow"){
            SlidWin_div.style.display = SlidWin_div.style.display == "none" ? "block" : "none";
        }
        else if(elem.value == "crop"){
            crop_div.style.display = crop_div.style.display == "none" ? "block" : "none";
        }
        else if(elem.value == "Hcrop"){
            Hcrop_div.style.display = Hcrop_div.style.display == "none" ? "block" : "none";
        }
        else if(elem.value == "minLen"){
           minLen_div.style.display = minLen_div.style.display == "none" ? "block" : "none";
        }
        
    }
    
    /*
    Function changes div display for single or paired end reads
    also called when changing from single or multiple files 
    */
    function changeIn(elem){
        
        var single_div = document.getElementById('single');
        
        var paired_div = document.getElementById('paired');
        
        if(elem.value == "Single"){
            single_div.style = "display:block;";
            paired_div.style = "display:none;";
        }
        else if(elem.value == "Paired"){
            single_div.style = "display:none;";
            paired_div.style = "display:block;";
        }
        else if(elem == "s_file"){
            document.getElementById('s_file').style = "display:block;";
            document.getElementById('s_files').style = "display:none;";
        }
        else if(elem == "s_files"){
            document.getElementById('s_file').style = "display:none;";
            document.getElementById('s_files').style = "display:block;";
        }
        else if(elem == "p_file"){
            document.getElementById('p_file').style = "display:block;";
            document.getElementById('p_files').style = "display:none;";
        }
        else if(elem == "p_files"){
            document.getElementById('p_file').style = "display:none;";
            document.getElementById('p_files').style = "display:block;";
        }
    }

</script>